FROM appleboy/drone-ssh:1.6.1-linux-amd64

LABEL version="1.0.0"
LABEL organization="Toumoro"
LABEL homepage="https://toumoro.com/"
LABEL maintainer="Benoit Verret <benoit.verret@toumoro.com>"
LABEL repository="https://github.com/toumoto/cicd-tools/tree/master/cloudflare-purge-action"

ENV INPUT_HOST=${HOST:-$INPUT_HOST}
ENV INPUT_PORT=${PORT:-$INPUT_PORT}
ENV INPUT_USERNAME=${USERNAME:-$INPUT_USERNAME}
ENV INPUT_PASSWORD=${PASSWORD:-$INPUT_PASSWORD}
ENV INPUT_PASSPHRASE=${PASSPHRASE:-$INPUT_PASSPHRASE}
ENV INPUT_SYNC=${SYNC:-$INPUT_SYNC}
ENV INPUT_TIMEOUT=${TIMEOUT:-$INPUT_TIMEOUT}
ENV INPUT_COMMAND_TIMEOUT=${COMMAND_TIMEOUT:-$INPUT_COMMAND_TIMEOUT}
ENV INPUT_KEY=${KEY:-$INPUT_KEY}
ENV INPUT_KEY_PATH=${KEY_PATH:-$INPUT_KEY_PATH}
ENV INPUT_FINGERPRINT=${FINGERPRINT:-$INPUT_FINGERPRINT}
ENV INPUT_SCRIPT=${SCRIPT:-$INPUT_SCRIPT}
ENV INPUT_SCRIPT_STOP=${SCRIPT_STOP:-$INPUT_SCRIPT_STOP}
ENV INPUT_ENVS=${ENVS:-$INPUT_ENVS}
ENV INPUT_DEBUG=${DEBUG:-$INPUT_DEBUG}
ENV INPUT_USE_INSECURE_CIPHER=${USE_INSECURE_CIPHER:-$INPUT_USE_INSECURE_CIPHER}
ENV INPUT_CIPHER=${CIPHER:-$INPUT_CIPHER}
ENV INPUT_PROXY_HOST=${PROXY_HOST:-$INPUT_PROXY_HOST}
ENV INPUT_PROXY_PORT=${PROXY_PORT:-$INPUT_PROXY_PORT}
ENV INPUT_PROXY_USERNAME=${PROXY_USERNAME:-$INPUT_PROXY_USERNAME}
ENV INPUT_PROXY_PASSWORD=${PROXY_PASSWORD:-$INPUT_PROXY_PASSWORD}
ENV INPUT_PROXY_PASSPHRASE=${PROXY_PASSPHRASE:-$INPUT_PROXY_PASSPHRASE}
ENV INPUT_PROXY_TIMEOUT=${PROXY_TIMEOUT:-$INPUT_PROXY_TIMEOUT}
ENV INPUT_PROXY_KEY=${PROXY_KEY:-$INPUT_PROXY_KEY}
ENV INPUT_PROXY_KEY_PATH=${PROXY_KEY_PATH:-$INPUT_PROXY_KEY_PATH}
ENV INPUT_PROXY_FINGERPRINT=${PROXY_FINGERPRINT:-$INPUT_PROXY_FINGERPRINT}
ENV INPUT_PROXY_USER_INSECURE_CIPHER=${PROXY_USER_INSECURE_CIPHER:-$INPUT_PROXY_USER_INSECURE_CIPHER}
ENV INPUT_PROXY_CYPHER=${PROXY_CYPHER:-$INPUT_PROXY_CYPHER}

ADD entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]